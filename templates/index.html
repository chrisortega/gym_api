{% extends "base.html" %}

{% block title %}GymAdmin{% endblock %}

{% block content %}
<style>
  .login-container {
    min-height: 80vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .login-card {
    width: 100%;
    max-width: 380px;
    border-radius: 16px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    padding: 2rem;
    background: #fff;
  }
  .login-card h3 {
    font-weight: 700;
    margin-bottom: 1.5rem;
  }
  .form-control {
    border-radius: 8px;
  }
  .btn-primary {
    border-radius: 8px;
    font-weight: 600;
  }
  .forgot-link {
    color: #6c757d;
  }
  .forgot-link:hover {
    color: #0d6efd;
  }
</style>

<div class="login-container px-3">
  <div class="login-card">
    <div class="text-center mb-3">
      <h3>üèãÔ∏è‚Äç‚ôÇÔ∏è GymAdmin</h3>
      <p class="text-muted mb-0">Please log in to continue</p>
    </div>

    <form id="loginForm" class="mt-4">
      <div class="mb-3">
        <label for="username" class="form-label fw-semibold">Email</label>
        <input type="text" id="username" name="username" class="form-control" required placeholder="Enter your email">
      </div>

      <div class="mb-3">
        <label for="password" class="form-label fw-semibold">Password</label>
        <input type="password" id="password" name="password" class="form-control" required placeholder="Enter your password">
      </div>

      <button type="submit" class="btn btn-primary w-100 py-2 mt-2">Login</button>

      <div class="mt-3 text-center">
        <a href="/forgot" class="forgot-link text-decoration-none">Forgot password?</a>
      </div>
    </form>

    <div id="message" class="text-center mt-3 text-info small"></div>
  </div>
</div>

<script>
  // Redirect if already logged in
  const token = localStorage.getItem('token');
  const user = localStorage.getItem('user');
  if (token && user) {
    window.location.href = '/dashboard';
  }

  const form = document.getElementById('loginForm');
  const msg = document.getElementById('message');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.textContent = "‚è≥ Logging in...";

    const data = {
      email: form.username.value,
      password: form.password.value
    };

    try {
      const res = await fetch('/api/login', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
      });

      const result = await res.json();

      if (res.ok && result.token) {
        localStorage.setItem('token', result.token);
        localStorage.setItem('user', JSON.stringify(result));
        msg.textContent = "‚úÖ Login successful! Redirecting...";
        setTimeout(() => window.location.href = '/dashboard', 800);
      } else {
        msg.textContent = result.error || "‚ùå Invalid credentials.";
      }
    } catch (err) {
      console.error(err);
      msg.textContent = "‚ö†Ô∏è Network error. Try again later.";
    }
  });
</script>
{% endblock %}
